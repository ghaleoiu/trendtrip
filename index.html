<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TrendTrip | ì„œìš¸ êµ¬ ë‹¨ìœ„ ìë™ ì½”ìŠ¤ ìƒì„±</title>
  <meta name="description" content="ê°ì •Â·ë‚ ì”¨Â·ì˜ˆì‚°Â·ìˆ™ë°•ì„ ë°˜ì˜í•´ ì„œìš¸ êµ¬ ë‹¨ìœ„ ìë™ ì½”ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤." />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root{ --brand:#0ea5e9 }
    html,body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
    .card{border-radius:1.25rem;box-shadow:0 8px 30px rgba(2,132,199,.08);padding:1.1rem;background:#fff}
    .btn{padding:.65rem 1rem;border-radius:.9rem;font-weight:700;transition:.12s;display:inline-flex;align-items:center;gap:.5rem}
    .btn:hover{transform:translateY(-1px)}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-outline{background:#fff;border:1px solid #e5e7eb}
    .badge{padding:.25rem .55rem;border-radius:.5rem;background:#f1f5f9;font-size:.7rem}
  </style>
</head>
<body class="bg-gradient-to-b from-sky-50 via-white to-white text-gray-800">

  <header class="sticky top-0 z-40">
    <div class="max-w-6xl mx-auto my-3 px-4 py-3 flex items-center justify-between bg-white/70 backdrop-blur rounded-xl border">
      <div class="font-extrabold text-lg flex items-center gap-2"><span class="text-2xl">ğŸ§­</span> TrendTrip</div>
      <div class="text-sm text-gray-500">ì„œìš¸ Â· êµ¬ ë‹¨ìœ„ ìë™ ì½”ìŠ¤</div>
    </div>
  </header>

  <section class="max-w-6xl mx-auto px-4 pt-6 grid md:grid-cols-3 gap-6">
    <!-- ì¢Œ: ì„¤ì • -->
    <div class="md:col-span-1 space-y-4">
      <div class="card">
        <div class="badge mb-2">ì—¬í–‰ ì„¤ì •</div>
        <label class="block text-sm mb-1">êµ¬ ì„ íƒ</label>
        <select id="district" class="w-full border rounded-xl px-3 py-2">
          <!-- ì„œìš¸ ì£¼ìš” êµ¬: ì¤‘ì‹¬ì¢Œí‘œ+ê²€ìƒ‰ë°˜ê²½(km) -->
          <option value="seongdong" data-center="37.5639,127.0364" data-radius="3">ì„±ë™êµ¬</option>
          <option value="gwangjin"  data-center="37.5387,127.0822" data-radius="3">ê´‘ì§„êµ¬</option>
          <option value="jung"      data-center="37.5636,126.9976" data-radius="3">ì¤‘êµ¬</option>
          <option value="jongno"    data-center="37.5733,126.9793" data-radius="3">ì¢…ë¡œêµ¬</option>
          <option value="yongsan"   data-center="37.5326,126.9905" data-radius="3">ìš©ì‚°êµ¬</option>
        </select>

        <div class="mt-3 grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm mb-1">ì—¬í–‰ ìœ í˜•</label>
            <select id="tripMode" class="w-full border rounded-xl px-3 py-2">
              <option value="6h">6ì‹œê°„ ë‹¹ì¼</option>
              <option value="1n2d">1ë°• 2ì¼</option>
              <option value="2n3d">2ë°• 3ì¼</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">ì´ ì˜ˆì‚°(â‚©)</label>
            <input id="budget" type="number" class="w-full border rounded-xl px-3 py-2" value="200000" />
          </div>
        </div>

        <div class="mt-3 grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm mb-1">ë‚ ì”¨</label>
            <select id="weather" class="w-full border rounded-xl px-3 py-2">
              <option value="sunny">ë§‘ìŒ</option>
              <option value="cloudy">íë¦¼</option>
              <option value="rainy">ë¹„</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">ì‹¤ë‚´/ì‹¤ì™¸</label>
            <select id="inout" class="w-full border rounded-xl px-3 py-2">
              <option value="any">ìƒê´€ì—†ìŒ</option>
              <option value="indoor">ì‹¤ë‚´</option>
              <option value="outdoor">ì‹¤ì™¸</option>
            </select>
          </div>
        </div>

        <div class="mt-3">
          <label class="text-sm flex items-center gap-2">
            <input id="strictBudget" type="checkbox" class="scale-110"> ì˜ˆì‚° ì—„ìˆ˜
          </label>
        </div>

        <div class="mt-4 flex gap-2">
          <button id="btnLoadArea" class="btn btn-outline">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button id="btnGenerate" class="btn btn-primary flex-1">ì½”ìŠ¤ ìƒì„±</button>
        </div>
        <div id="status" class="text-xs text-gray-500 mt-2"></div>
      </div>

      <div class="card">
        <div class="badge mb-2">ì´ì•¡</div>
        <div id="moneyBox" class="text-sm text-gray-700 space-y-1">
          <div>ì•¡í‹°ë¹„í‹°: -</div>
          <div>ìˆ™ë°•: -</div>
          <div class="font-semibold">í•©ê³„: -</div>
        </div>
      </div>
    </div>

    <!-- ìš°: ì§€ë„+ì¼ì • -->
    <div class="md:col-span-2 space-y-4">
      <div class="card">
        <div class="font-bold mb-2">ì§€ë„</div>
        <div id="map" class="w-full h-[420px] rounded-xl"></div>
      </div>
      <div class="card">
        <div class="font-bold mb-2">ìë™ ìƒì„± ì¼ì •</div>
        <ol id="itinerary" class="list-decimal list-inside text-sm text-gray-700"></ol>
      </div>
    </div>
  </section>

  <script>
    // ===== ê¸°ë³¸ ìƒìˆ˜/ìƒíƒœ =====
    const TOURAPI_PROXY = "/api/tourapi"; // ê°™ì€ ë„ë©”ì¸ì— ë°°í¬í–ˆë‹¤ê³  ê°€ì •
    const CENTER = { lat: 37.5665, lng: 126.9780 };

    let PLACES = []; // ê´€ê´‘ì§€(ì•¡í‹°ë¹„í‹°)
    let HOTELS = []; // ìˆ™ë°•(1ë°• ë¹„ìš©)

    // ì§€ë„
    let map, markersLayer, routeLine;
    (function initMap(){
      map = L.map('map').setView([CENTER.lat, CENTER.lng], 12);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19, attribution:'Â© OpenStreetMap'}).addTo(map);
      markersLayer = L.layerGroup().addTo(map);
    })();

    // ===== ìœ í‹¸ =====
    function deriveThemesFromTitle(t=''){
      const tags = [];
      if (/ê³µì›|ìˆ²|ì‚°ì±…|ì²œ|í˜¸ìˆ˜|ì„¬|ì˜¤ë¦„|ë‘˜ë ˆê¸¸|ì„±ê³½ê¸¸/.test(t)) tags.push('ì‚°ì±…','íë§');
      if (/íƒ€ì›Œ|ì „ë§|ìŠ¤ì¹´ì´|ë·°|í¬í† |ì•¼ê²½/.test(t)) tags.push('ë·°','ì„¤ë ˜');
      if (/ë°•ë¬¼ê´€|ë¯¸ìˆ ê´€|ì—­ì‚¬|ê¶|ì„±|ì „ì‹œ|ê¸°ë…ê´€/.test(t)) tags.push('ì—­ì‚¬','ì‚¬ìƒ‰');
      if (!tags.length) tags.push('íŠ¸ë Œë“œ');
      return Array.from(new Set(tags));
    }
    function estimatePlaceCost(title="", type="outdoor", ctid=""){
      const t = title || "";
      if (ctid==="14" || /ë°•ë¬¼ê´€|ë¯¸ìˆ ê´€|ì „ì‹œ|ê¸°ë…ê´€/.test(t)) return 5000 + Math.floor(Math.random()*7000);
      if (ctid==="28" || /ì²´í—˜|í…Œë§ˆ|VR|AR|ì¹´íŠ¸|ì„œí•‘|ì•„ì¿ ì•„ë¦¬ì›€|ì¼€ì´ë¸”ì¹´|ì „ë§ëŒ€/.test(t)) return 12000 + Math.floor(Math.random()*14000);
      if (/íƒ€ì›Œ|ì „ë§|Níƒ€ì›Œ|ì„œìš¸íƒ€ì›Œ/.test(t)) return 15000 + Math.floor(Math.random()*8000);
      if (/ê³µì›|ìˆ²|ì‚°ì±…|ì²œ|ê°•|í˜¸ìˆ˜|í•´ë³€|ì˜¤ë¦„|ì‹œì¥|ê±°ë¦¬|ë‘˜ë ˆê¸¸|ì„±ê³½ê¸¸/.test(t)) return Math.random()<0.5?0:1000+Math.floor(Math.random()*2000);
      if (/ê¶|ê³ ê¶|ì™•ë¦‰|ì‚¬ì°°|í•œì˜¥|ë¬¸í™”ì¬/.test(t)) return Math.floor(Math.random()*4000);
      if (/ë°±í™”ì |ì•„ìš¸ë ›|ëª°|ë”í˜„ëŒ€|í”Œë˜ê·¸ì‹­|ì‡¼í•‘|ë§ˆì¼“/.test(t)) return 0;
      return type==='indoor' ? 6000 + Math.floor(Math.random()*9000) : (Math.random()<0.7?0:1000+Math.floor(Math.random()*3000));
    }
    function estimateHotelNight(title=""){
      const t = title || "";
      if (/ë¦¬ì¡°íŠ¸|ìŠ¤íŒŒ|í”„ë¦¬ë¯¸ì–´|ìˆ˜ì˜ì¥|ì½˜ë„/.test(t)) return 120000 + Math.floor(Math.random()*80000);
      if (/í˜¸í…”|ê´€ê´‘í˜¸í…”|í•´ìš´ëŒ€|ì‹œí‹°|ë§ˆì´ìŠ¤/.test(t)) return 80000 + Math.floor(Math.random()*60000);
      if (/í•œì˜¥|ìŠ¤í…Œì´|íœì…˜|ê²ŒìŠ¤íŠ¸|ë¯¼ë°•|í˜¸ìŠ¤í…”/.test(t)) return 40000 + Math.floor(Math.random()*40000);
      return 70000 + Math.floor(Math.random()*60000);
    }

    function scorePlace(p, weather){
      const themeHit = 6; // ê°ì • ì—†ì´ë„ ê¸°ë³¸ ê°€ì¤‘
      const fomo = p.fomo/10;
      const weatherBoost = (weather==='rainy' && p.type==='indoor') ? 6 : (weather==='sunny' && p.type==='outdoor') ? 4 : 0;
      const soft = (p.cost||0) > 0 ? - ((p.cost||0) >= 18000 ? 3 : ((p.cost||0) >= 10000 ? 1 : 0)) : 1;
      return themeHit + weatherBoost + fomo + soft;
    }
    function scoreHotel(h){ return (h.fomo/10) + (h.star||4); }

    // ===== ë¡œë”© =====
    async function fetchByLocation(center, radiusMeters, contentTypeId="12", num=100){
      const u = new URL(TOURAPI_PROXY, location.origin);
      u.searchParams.set("by","location");
      u.searchParams.set("mapX", center.lng);
      u.searchParams.set("mapY", center.lat);
      u.searchParams.set("radius", String(radiusMeters));
      u.searchParams.set("contentTypeId", contentTypeId);
      u.searchParams.set("numOfRows", String(num));
      const r = await fetch(u.toString());
      const data = await r.json();
      return data?.response?.body?.items?.item || [];
    }

    function mapItemsToPlaces(items){
      return (items||[]).map((it,idx)=>{
        const typeGuess = (String(it.contenttypeid)==='14' || /ë°•ë¬¼ê´€|ë¯¸ìˆ ê´€|ì „ì‹œ/.test(it.title)) ? 'indoor' : 'outdoor';
        const themes = deriveThemesFromTitle(it.title||"");
        const cost = estimatePlaceCost(it.title||"", typeGuess, String(it.contenttypeid||""));
        return {
          id: idx+1, name: it.title,
          lat: Number(it.mapy), lng: Number(it.mapx),
          type: typeGuess, cost, themes, fomo: 70 + (idx%25)
        };
      }).filter(p=>isFinite(p.lat)&&isFinite(p.lng));
    }
    function mapItemsToHotels(items){
      return (items||[]).map((it,idx)=>{
        const nightCost = estimateHotelNight(it.title||"");
        return {
          id: 1000+idx+1, name: it.title, type:"hotel",
          lat: Number(it.mapy), lng: Number(it.mapx),
          nightCost, star: 4.0 + (idx%10)/10, fomo: 70 + (idx%25)
        };
      }).filter(h=>isFinite(h.lat)&&isFinite(h.lng));
    }

    async function loadDistrict(){
      const opt = document.getElementById('district').selectedOptions[0];
      const [lat,lng] = opt.dataset.center.split(',').map(Number);
      const radiusKm = Number(opt.dataset.radius||3);
      const center = {lat, lng};
      document.getElementById('status').textContent = 'ë°ì´í„° ë¡œë”©â€¦';
      try{
        const [placeRaw, hotelRaw] = await Promise.all([
          fetchByLocation({lat,lng}, radiusKm*1000, "12", 120),
          fetchByLocation({lat,lng}, radiusKm*1000, "32", 120)
        ]);
        PLACES = mapItemsToPlaces(placeRaw);
        HOTELS = mapItemsToHotels(hotelRaw);
        setMapCenter(lat,lng,12);
        document.getElementById('status').textContent = `ì¥ì†Œ ${PLACES.length} Â· ìˆ™ì†Œ ${HOTELS.length} ë¡œë“œ`;
      }catch(e){
        console.error(e);
        document.getElementById('status').textContent = 'ë¡œë”© ì‹¤íŒ¨(ëª©ì—…ìœ¼ë¡œ ëŒ€ì²´)';
        // ê°„ë‹¨ ëª©ì—…
        PLACES = mapItemsToPlaces([]);
        HOTELS  = mapItemsToHotels([]);
      }
    }

    function setMapCenter(lat, lng, zoom=12){ map.setView([lat, lng], zoom); }

    // ===== ìë™ ì½”ìŠ¤ ìƒì„± =====
    function tripMeta(mode){
      const nights = mode==="1n2d"?1 : mode==="2n3d"?2 : 0;
      const days = nights>0 ? nights+1 : 1;
      // 6h ë‹¹ì¼: 3~4ê³³ / 1ë°•2ì¼: 7~8ê³³ / 2ë°•3ì¼: 10~12ê³³ ì •ë„
      const placesPerDay = (nights===0)?3 : (nights===1)?4 : 4;
      const maxPlaces = days * placesPerDay;
      // ì‹œì‘/ìˆ™ë°• ì‹œê°„í‘œ (ê°„ë‹¨ ê³ ì •)
      return { nights, days, maxPlaces };
    }

    function pickActivities(weather, inout, actBudget, maxPlaces, strict){
      const perItemCeil = maxPlaces>0 ? Math.max(3000, Math.floor((actBudget*0.7)/maxPlaces*1.2)) : Infinity;
      const pool = PLACES
        .filter(p => inout==='any' ? true : p.type===inout)
        .map(p => ({...p, score: scorePlace(p, weather)}))
        .sort((a,b)=> b.score-a.score)
        .slice(0,60);

      // ê·¸ë¦¬ë””(ì ìˆ˜/ë¹„ìš©) + ë¬´ë£Œìš°ì„ 
      let filtered = pool.filter(p => (p.cost||0) <= perItemCeil);
      if(filtered.length < Math.max(6, maxPlaces*2)) filtered = pool; // ì§€ë‚˜ì¹˜ê²Œ ì¢ìœ¼ë©´ ì™„í™”

      const freeFirst = filtered.filter(p => (p.cost||0)===0).slice(0, Math.min(3, maxPlaces));
      let remain = Math.floor(actBudget*0.7) - freeFirst.reduce((s,p)=>s+(p.cost||0),0);
      let slots = maxPlaces - freeFirst.length;

      const candidates = filtered
        .filter(p=>!freeFirst.find(f=>f.id===p.id))
        .sort((a,b)=>{
          const ra = (a.cost||0)>0 ? (a.score/a.cost) : a.score*10;
          const rb = (b.cost||0)>0 ? (b.score/b.cost) : b.score*10;
          return rb-ra;
        });

      const chosen=[...freeFirst];
      for(const p of candidates){
        if(slots<=0) break;
        const c = p.cost||0;
        if(c<=remain){ chosen.push(p); remain-=c; slots--; }
        else if(!strict && chosen.length===0 && c<=actBudget*0.8){ chosen.push(p); break; }
      }
      // ë³´ì¶©
      if(chosen.length < maxPlaces){
        const cheap = candidates.filter(p=>!chosen.find(x=>x.id===p.id)).sort((a,b)=>(a.cost||0)-(b.cost||0));
        for(const p of cheap){ if(chosen.length>=maxPlaces) break; const c=p.cost||0; if(c<=remain){ chosen.push(p); remain-=c; } }
      }
      // ë¬´ë£Œë¡œ ì±„ìš°ê¸°
      if(chosen.length < maxPlaces){
        const moreFree = filtered.filter(p=>(p.cost||0)===0 && !chosen.find(x=>x.id===p.id));
        for(const p of moreFree){ if(chosen.length>=maxPlaces) break; chosen.push(p); }
      }
      return chosen.slice(0,maxPlaces);
    }

    function pickHotels(nights, hotelBudget, strict){
      if(nights<=0) return [];
      const scored = HOTELS.map(h=> ({...h, score: scoreHotel(h) + (h.nightCost>0 ? 30000/(h.nightCost) : 0)}))
                           .sort((a,b)=> b.score-a.score);
      const perNight = Math.max(30000, Math.floor(hotelBudget / nights));
      let pool = scored.filter(h => (h.nightCost||0) <= perNight*1.15);
      if(pool.length===0) pool = scored.slice(-10).sort((a,b)=>(a.nightCost||0)-(b.nightCost||0)); // ì œì¼ ì‹¼ ì¶•ì—ì„œ

      const chosen = [];
      let remain = hotelBudget;
      for(const h of pool){
        if(chosen.length>=nights) break;
        const c=h.nightCost||0;
        if(!strict || c<=remain){ chosen.push(h); remain -= c; }
      }
      // ë¶€ì¡±í•˜ë©´ ë” ì‹¼ ê²ƒìœ¼ë¡œ êµì²´ ì‹œë„
      if(strict){
        let total = chosen.reduce((s,h)=>s+(h.nightCost||0),0);
        if(total>hotelBudget){
          const cheap = HOTELS.slice().sort((a,b)=>(a.nightCost||0)-(b.nightCost||0));
          chosen.length = 0;
          for(let i=0;i<nights;i++){
            const target = Math.max(20000, Math.floor((hotelBudget - chosen.reduce((s,h)=>s+(h.nightCost||0),0)) / (nights-i)));
            const cand = cheap.find(h => (h.nightCost||0) <= target) || cheap[0];
            chosen.push(cand);
          }
        }
      }
      return chosen.slice(0,nights);
    }

    function buildSchedule(places, hotels, mode){
      // ê°„ë‹¨ íƒ€ì„ë¼ì¸: 6h(10:00~16:00, 90ë¶„/ê³³), 1n2d/2n3dëŠ” 10:00~18:00 (ì ì‹¬ í¬í•¨)
      const startTime = 10*60; // minutes
      const perSlot = (mode==="6h")? 90 : 100;
      const lunchTime = 13*60;

      const { nights, days } = tripMeta(mode);
      const perDay = Math.ceil(places.length / days);
      const blocks = [];
      let idx=0;

      for(let d=0; d<days; d++){
        let t = startTime;
        blocks.push({ type:'day', label:`Day ${d+1}` });
        for(let k=0;k<perDay;k++){
          const p = places[idx++];
          if(!p) break;
          // ì ì‹¬ ìŠ¬ë¡¯
          if(t < lunchTime && t+perSlot >= lunchTime){
            blocks.push({ type:'meal', time: minutesToHHMM(lunchTime), label:'ì ì‹¬' });
            t = lunchTime + 60;
          }
          blocks.push({ type:'place', time: minutesToHHMM(t), name:p.name, cost:p.cost, lat:p.lat, lng:p.lng });
          t += perSlot;
        }
        // í•´ë‹¹ ë°¤ì˜ ìˆ™ì†Œ
        if(d < nights && hotels[d]){
          blocks.push({ type:'hotel', time: 'ì²´í¬ì¸(18:00~)', name: hotels[d].name, cost: hotels[d].nightCost, lat: hotels[d].lat, lng: hotels[d].lng });
        }
      }
      return blocks;
    }
    function minutesToHHMM(m){ const h=Math.floor(m/60), mm=String(m%60).padStart(2,'0'); return `${h}:${mm}`; }

    // ===== ë Œë”ë§ =====
    function renderItinerary(blocks){
      const it = document.getElementById('itinerary');
      it.innerHTML = '';
      markersLayer.clearLayers();
      if(routeLine){ map.removeLayer(routeLine); routeLine=null; }

      const routePts = [];
      blocks.forEach(b=>{
        const li = document.createElement('li');
        if(b.type==='day'){
          li.className = 'mt-2 font-semibold';
          li.textContent = b.label;
        }else if(b.type==='meal'){
          li.className = 'ml-4 text-gray-600';
          li.textContent = `${b.time} â€¢ ${b.label}`;
        }else if(b.type==='place'){
          li.className = 'ml-4';
          li.textContent = `${b.time} â€¢ ${b.name} (~${(b.cost||0).toLocaleString()}ì›)`;
          routePts.push([b.lat,b.lng]);
          markersLayer.addLayer(L.marker([b.lat,b.lng]).bindPopup(b.name));
        }else if(b.type==='hotel'){
          li.className = 'ml-4';
          li.textContent = `ğŸ¨ ${b.time} â€¢ ìˆ™ì†Œ: ${b.name} (1ë°• ~${(b.cost||0).toLocaleString()}ì›)`;
          routePts.push([b.lat,b.lng]);
          markersLayer.addLayer(L.marker([b.lat,b.lng]).bindPopup("ğŸ¨ "+b.name));
        }
        it.appendChild(li);
      });

      if(routePts.length>=2){
        routeLine = L.polyline(routePts, {weight:5, opacity:.9, color:'#0ea5e9'}).addTo(map);
        map.fitBounds(routeLine.getBounds(), {padding:[20,20]});
      }else if(routePts[0]){
        map.setView(routePts[0], 13);
      }
    }

    function renderMoney(actTotal, hotelTotal){
      const m = document.getElementById('moneyBox');
      m.innerHTML = `
        <div>ì•¡í‹°ë¹„í‹°: ~${actTotal.toLocaleString()}ì›</div>
        <div>ìˆ™ë°•: ~${hotelTotal.toLocaleString()}ì›</div>
        <div class="font-semibold">í•©ê³„: ~${(actTotal+hotelTotal).toLocaleString()}ì›</div>
      `;
    }

    // ===== ì´ë²¤íŠ¸ =====
    document.getElementById('btnLoadArea').onclick = loadDistrict;

    document.getElementById('btnGenerate').onclick = async ()=>{
      if(PLACES.length===0 || HOTELS.length===0){
        await loadDistrict(); // ë°ì´í„° ì—†ìœ¼ë©´ ë¨¼ì € ë¡œë“œ
      }
      const mode = document.getElementById('tripMode').value;
      const budget = Number(document.getElementById('budget').value||0);
      const weather = document.getElementById('weather').value;
      const inout = document.getElementById('inout').value;
      const strict = !!document.getElementById('strictBudget').checked;

      const { nights, maxPlaces } = tripMeta(mode);
      const hotelBudget = nights>0 ? Math.floor(budget*0.6) : 0;
      const actBudget = budget - hotelBudget;

      // ì„ íƒ
      const activities = pickActivities(weather, inout, actBudget, maxPlaces, strict);
      const hotels = pickHotels(nights, hotelBudget, strict);

      // ìŠ¤ì¼€ì¤„ ì¡°ë¦½
      const blocks = buildSchedule(activities, hotels, mode);
      renderItinerary(blocks);

      // ë¹„ìš© í•©ì‚°
      const actTotal = activities.reduce((s,p)=>s+(p.cost||0),0);
      const hotelTotal = hotels.reduce((s,h)=>s+(h.nightCost||0),0);
      renderMoney(actTotal, hotelTotal);

      document.getElementById('status').textContent =
        `ì½”ìŠ¤ ìƒì„± ì™„ë£Œ Â· ì•¡í‹°ë¹„í‹° ${activities.length} Â· ìˆ™ì†Œ ${hotels.length} Â· ì˜ˆì‚° ${budget.toLocaleString()}ì› (ìˆ™ë°• ${hotelBudget.toLocaleString()} / ì•¡í‹°ë¹„í‹° ${actBudget.toLocaleString()})`;
    };

    // ì´ˆê¸° ìƒíƒœ ë¬¸êµ¬
    document.getElementById('status').textContent = 'êµ¬ ì„ íƒ í›„ [ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°] â†’ [ì½”ìŠ¤ ìƒì„±]';
  </script>
</body>
</html>